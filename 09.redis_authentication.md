# Secci칩n 09: Redis Authentication

---

## Introducci칩n a Access Control List (ACL)

`Redis`, por defecto, no requiere autenticaci칩n en una instalaci칩n b치sica. Esto significa que cualquier cliente que se
conecte puede ejecutar comandos sin restricci칩n, lo cual no es recomendable en entornos productivos.

Algunos puntos clave:

- El usuario `default` tiene privilegios de administrador y no requiere contrase침a al inicio.
- En `Redis < 6`:
    - No exist칤a el concepto de usuarios.
    - Solo se pod칤a configurar una contrase침a global.
    - Se utilizaba: `AUTH <password>`
- En `Redis >= 6`:
    - Se introdujo el sistema ACL (Access Control List).
    - Permite definir usuarios con nombre, contrase침a y privilegios espec칤ficos.
    - Se autentica con: `AUTH <username> <password>`

### Comandos principales de ACL

| Comando                               | Descripci칩n                                           |
|---------------------------------------|-------------------------------------------------------|
| `ACL LIST`                            | Lista todos los usuarios configurados y sus permisos. |
| `ACL WHOAMI`                          | Muestra el usuario actualmente autenticado.           |
| `ACL SETUSER <username> > <password>` | Crea o actualiza un usuario con contrase침a.           |
| `ACL SETUSER <username> nopass`       | Crea un usuario sin contrase침a.                       |
| `ACL SETUSER <username> on`           | Habilita al usuario.                                  |
| `ACL SETUSER <username> off`          | Deshabilita al usuario.                               |
| `ACL DELUSER <username>`              | Elimina un usuario.                                   |

### Ejemplos pr치cticos

- Ver usuarios actuales

````bash
127.0.0.1:6379> acl list
1) "user default on nopass sanitize-payload ~* &* +@all"
````

El resultado indica:

- `default`: usuario activo.
- `nopass`: sin contrase침a.
- `+@all`: permisos completos.

- Ver usuario actual

````bash
127.0.0.1:6379> acl whoami
"default" 
````

- Crear usuarios

````bash
127.0.0.1:6379> ACL SETUSER sam on >'secret'
OK
127.0.0.1:6379> ACL SETUSER jake >'secret'
OK
127.0.0.1:6379> ACL SETUSER magadiflo >123456
OK 
````

游늷 Observaciones:

- `>` indica que lo que sigue es la contrase침a.
- Por defecto, el usuario reci칠n creado queda deshabilitado a menos que uses on.

- Revisar usuarios

````bash
127.0.0.1:6379> acl list
1) "user default on nopass sanitize-payload ~* &* +@all"
2) "user jake off sanitize-payload #2bb80d537b1da3e38bd30361aa855686bde0eacd7162fef6a25fe97bf527a25b resetchannels -@all"
3) "user magadiflo off sanitize-payload #8d969eef6ecad3c29a3a629280e686cf0c3f5d5a86aff3ca12020c923adc6c92 resetchannels -@all"
4) "user sam on sanitize-payload #2bb80d537b1da3e38bd30361aa855686bde0eacd7162fef6a25fe97bf527a25b resetchannels -@all" 
````

Notas:

- El `#<hash>` corresponde al hash `SHA-256` de la contrase침a.
- `resetchannels` y `-@all` aparecen porque los usuarios no tienen permisos definidos expl칤citamente.

- Eliminar usuarios

````bash
127.0.0.1:6379> acl deluser jake sam
(integer) 2 
````

- Habilitar un usuario existente

````bash
127.0.0.1:6379> acl setuser magadiflo on
OK 
````

- Autenticarse con un usuario distinto

````bash
127.0.0.1:6379> auth magadiflo 123456
OK 
````

- Regresamos al usuario default

````bash
127.0.0.1:6379> auth default nopass
OK 
````

- Confirmar usuario actual

````bash
127.0.0.1:6379> acl whoami
"default" 
````

### Notas importantes

- En producci칩n, nunca uses el usuario `default` con acceso total y sin contrase침a.
- Es recomendable:
    - Deshabilitar `default` `(ACL SETUSER default off)`.
    - Crear usuarios espec칤ficos con permisos limitados seg칰n el caso de uso.
- Los permisos se definen con `categor칤as` (`+@read`, `+@write`, `+@admin`, etc.) o comandos individuales
  (`+get`, `-del`, etc.).
- Los usuarios pueden restringirse tambi칠n a claves espec칤ficas `(~prefix:*)`.
